<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<c:set var="ctx" value="${pageContext.request.contextPath}"/>

<jsp:include page="/WEB-INF/views/layout/admin-header.jsp"/>
<jsp:include page="/WEB-INF/views/layout/admin-sidebar.jsp"/>

<main class="container">
  <h2>Quản lý Newsletter</h2>

  <form method="post" action="${ctx}/admin/newsletter" class="form">
    <input type="hidden" name="action" value="${empty item ? 'create' : 'update'}"/>
    <input type="hidden" name="id" value="${item.id}"/>

    <label>Tiêu đề
      <input name="title" value="${item.title}" required/>
    </label>

    <label>Nội dung
      <textarea name="content" rows="6">${item.content}</textarea>
    </label>

    <label>Trạng thái gửi?
      <select name="status">
        <option value="DRAFT" ${item.status=='DRAFT'?'selected':''}>Nháp</option>
        <option value="SENT" ${item.status=='SENT'?'selected':''}>Đã gửi</option>
      </select>
    </label>

    <button type="submit">${empty item ? 'Thêm mới' : 'Cập nhật'}</button>
    <c:if test="${not empty item}">
      <a class="btn" href="${ctx}/admin/newsletter">Hủy</a>
    </c:if>
  </form>

  <table class="table">
    <thead><tr><th>ID</th><th>Tiêu đề</th><th>Trạng thái</th><th>Hành động</th></tr></thead>
    <tbody>
      <c:forEach var="n" items="${items}">
        <tr>
          <td>${n.id}</td><td>${n.title}</td><td>${n.status}</td>
          <td class="actions">
            <a href="${ctx}/admin/newsletter?action=edit&id=${n.id}">Sửa</a>
            <form method="post" action="${ctx}/admin/newsletter" style="display:inline" onsubmit="return confirm('Xóa?');">
              <input type="hidden" name="action" value="delete"/>
              <input type="hidden" name="id" value="${n.id}"/>
              <button type="submit">Xóa</button>
            </form>
          </td>
        </tr>
      </c:forEach>
    </tbody>
  </table>
</main>

<jsp:include page="/WEB-INF/views/layout/footer.jsp"/>
