<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="jakarta.tags.core" %>
<%@ taglib prefix="fmt" uri="jakarta.tags.fmt" %>
<c:set var="pageTitle" value="Qu·∫£n l√Ω B√†i vi·∫øt - NewsPortal" />

<%@ include file="../layout/admin-header.jsp" %>

<!-- Main Content -->
<main class="modern-main-content">
    <div class="content-container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="page-title-section">
                <h1 class="page-title">Qu·∫£n l√Ω B√†i vi·∫øt</h1>
                <p class="page-subtitle">Xem v√† qu·∫£n l√Ω t·∫•t c·∫£ b√†i vi·∫øt c·ªßa b·∫°n</p>
            </div>
            <div class="page-actions">
                <a href="${pageContext.request.contextPath}/reporter/post-create" class="btn-primary">
                    <span class="btn-icon">‚úèÔ∏è</span>
                    <span class="btn-text">Vi·∫øt b√†i m·ªõi</span>
                </a>
            </div>
        </div>

        <!-- Statistics Cards -->
        <div class="stats-grid">
            <div class="stat-card total">
                <div class="stat-icon">üìä</div>
                <div class="stat-content">
                    <div class="stat-number">${totalPosts != null ? totalPosts : 0}</div>
                    <div class="stat-label">T·ªïng b√†i vi·∫øt</div>
                </div>
                <div class="stat-trend">
                    <span class="trend-indicator positive">üìà</span>
                </div>
            </div>
            
            <div class="stat-card pending">
                <div class="stat-icon">‚è≥</div>
                <div class="stat-content">
                    <div class="stat-number">${pendingPosts != null ? pendingPosts : 0}</div>
                    <div class="stat-label">Ch·ªù duy·ªát</div>
                </div>
                <div class="stat-trend">
                    <span class="trend-indicator neutral">‚è∏Ô∏è</span>
                </div>
            </div>
            
            <div class="stat-card approved">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-content">
                    <div class="stat-number">${approvedPosts != null ? approvedPosts : 0}</div>
                    <div class="stat-label">ƒê√£ duy·ªát</div>
                </div>
                <div class="stat-trend">
                    <span class="trend-indicator positive">üéâ</span>
                </div>
            </div>
        </div>

        <!-- Articles List Section -->
        <div class="dashboard-section">
    <c:if test="${not empty error}">
      <div class="alert alert-error">${error}</div>
    </c:if>
    
    <c:choose>
      <c:when test="${empty posts}">
        <div class="empty-state">
          <div class="empty-icon">üìù</div>
          <h3>Ch∆∞a c√≥ b√†i vi·∫øt n√†o</h3>
          <p>H√£y b·∫Øt ƒë·∫ßu vi·∫øt b√†i ƒë·∫ßu ti√™n c·ªßa b·∫°n!</p>
          <a class="btn" href="${pageContext.request.contextPath}/reporter/post-create">Vi·∫øt b√†i m·ªõi</a>
        </div>
      </c:when>
      <c:otherwise>
        <!-- Desktop/Tablet Table View -->
        <div class="table-wrapper">
          <table class="table">
            <thead>
              <tr>
                <th>STT</th>
                <th>Ti√™u ƒë·ªÅ</th>
                <th>Chuy√™n m·ª•c</th>
                <th>Ng√†y ƒëƒÉng</th>
                <th>L∆∞·ª£t xem</th>
                <th>Tr·∫°ng th√°i</th>
                <th>Thao t√°c</th>
              </tr>
            </thead>
            <tbody>
              <c:forEach var="post" items="${posts}" varStatus="status">
                <tr>
                  <td class="text-center">${status.index + 1}</td>
                  <td class="post-title">
                    <div class="title-wrapper">
                      <strong>${post.title}</strong>
                      <c:if test="${post.home}">
                        <span class="badge home">Trang nh·∫•t</span>
                      </c:if>
                    </div>
                  </td>
                  <td>
                    <span class="category-tag">
                      ${categoryMap[post.categoryId] != null ? categoryMap[post.categoryId] : 'Ch∆∞a ph√¢n lo·∫°i'}
                    </span>
                  </td>
                  <td>
                    <c:choose>
                      <c:when test="${post.postedDate != null}">
                        ${post.postedDate.toString().substring(0,16).replace('T', ' ')}
                      </c:when>
                      <c:otherwise>-</c:otherwise>
                    </c:choose>
                  </td>
                  <td>
                    <span class="view-count">${post.viewCount}</span>
                  </td>
                  <td>
                    <span class="status-badge ${post.approved ? 'approved' : 'pending'}">
                      ${post.approved ? 'ƒê√£ duy·ªát' : 'Ch·ªù duy·ªát'}
                    </span>
                  </td>
                  <td class="actions">
                    <div class="action-buttons">
                      <a href="${pageContext.request.contextPath}/news/detail?id=${post.id}" 
                         class="btn-small ghost" title="Xem b√†i vi·∫øt">üëÅÔ∏è</a>
                      <a href="${pageContext.request.contextPath}/reporter/post-edit?id=${post.id}" 
                         class="btn-small" title="Ch·ªânh s·ª≠a">‚úèÔ∏è</a>
                      <form method="post" action="${pageContext.request.contextPath}/reporter/post-delete" 
                            style="display: inline;" onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b√†i vi·∫øt n√†y?');">
                        <input type="hidden" name="id" value="${post.id}">
                        <button type="submit" class="btn-small danger" title="X√≥a b√†i vi·∫øt">üóëÔ∏è</button>
                      </form>
                    </div>
                  </td>
                </tr>
              </c:forEach>
            </tbody>
          </table>
        </div>

        <!-- Mobile Card View -->
        <div class="mobile-cards">
          <c:forEach var="post" items="${posts}">
            <div class="mobile-card">
              <div class="mobile-card-header">
                <div class="mobile-card-title">
                  ${post.title}
                  <c:if test="${post.home}">
                    <span class="badge home">Trang nh·∫•t</span>
                  </c:if>
                </div>
                <div class="mobile-card-status">
                  <span class="status-badge ${post.approved ? 'approved' : 'pending'}">
                    ${post.approved ? 'ƒê√£ duy·ªát' : 'Ch·ªù duy·ªát'}
                  </span>
                </div>
              </div>
              
              <div class="mobile-card-meta">
                <div class="mobile-card-meta-item">
                  <span class="mobile-card-meta-label">Chuy√™n m·ª•c</span>
                  <span class="mobile-card-meta-value">
                    ${categoryMap[post.categoryId] != null ? categoryMap[post.categoryId] : 'Ch∆∞a ph√¢n lo·∫°i'}
                  </span>
                </div>
                <div class="mobile-card-meta-item">
                  <span class="mobile-card-meta-label">L∆∞·ª£t xem</span>
                  <span class="mobile-card-meta-value">${post.viewCount}</span>
                </div>
                <div class="mobile-card-meta-item">
                  <span class="mobile-card-meta-label">Ng√†y ƒëƒÉng</span>
                  <span class="mobile-card-meta-value">
                    <c:choose>
                      <c:when test="${post.postedDate != null}">
                        ${post.postedDate.toString().substring(0,10)}
                      </c:when>
                      <c:otherwise>-</c:otherwise>
                    </c:choose>
                  </span>
                </div>
                <div class="mobile-card-meta-item">
                  <span class="mobile-card-meta-label">Th·ªùi gian</span>
                  <span class="mobile-card-meta-value">
                    <c:choose>
                      <c:when test="${post.postedDate != null}">
                        ${post.postedDate.toString().substring(11,16)}
                      </c:when>
                      <c:otherwise>-</c:otherwise>
                    </c:choose>
                  </span>
                </div>
              </div>
              
              <div class="mobile-card-actions">
                <a href="${pageContext.request.contextPath}/news/detail?id=${post.id}" 
                   class="btn-small ghost">üëÅÔ∏è Xem</a>
                <a href="${pageContext.request.contextPath}/reporter/post-edit?id=${post.id}" 
                   class="btn-small">‚úèÔ∏è S·ª≠a</a>
                <form method="post" action="${pageContext.request.contextPath}/reporter/post-delete" 
                      style="display: inline;" onsubmit="return confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b√†i vi·∫øt n√†y?');">
                  <input type="hidden" name="id" value="${post.id}">
                  <button type="submit" class="btn-small danger">üóëÔ∏è X√≥a</button>
                </form>
              </div>
            </div>
          </c:forEach>
        </div>
      </c:otherwise>
    </c:choose>
        </div>
    </div>
</main>

<style>
/* Reuse modern layout styles */
.modern-main-content {
    min-height: calc(100vh - 70px);
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    padding: 2rem 0;
}

.content-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 2rem;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 3rem;
    background: white;
    padding: 2rem;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

.page-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: #2d3748;
    margin: 0 0 0.5rem 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.page-subtitle {
    color: #718096;
    font-size: 1.1rem;
    margin: 0;
}

.btn-primary {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1rem 2rem;
    border-radius: 12px;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.stat-card {
    background: white;
    padding: 2rem;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    display: flex;
    align-items: center;
    gap: 1.5rem;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
}

.stat-card.total::before { background: linear-gradient(90deg, #3182ce, #2c5282); }
.stat-card.pending::before { background: linear-gradient(90deg, #ed8936, #dd6b20); }
.stat-card.approved::before { background: linear-gradient(90deg, #38a169, #2f855a); }

.stat-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.12);
}

.stat-icon {
    font-size: 3rem;
    opacity: 0.8;
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: #2d3748;
    line-height: 1;
    margin-bottom: 0.5rem;
}

.stat-label {
    color: #718096;
    font-size: 1rem;
    font-weight: 500;
}

.trend-indicator.positive { color: #38a169; }
.trend-indicator.neutral { color: #ed8936; }

.dashboard-section {
    background: white;
    border-radius: 16px;
    padding: 2rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.08);
}

.empty-state {
    text-align: center;
    padding: 4rem 2rem;
}

.empty-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
    opacity: 0.6;
}

.empty-state h3 {
    font-size: 1.5rem;
    color: #2d3748;
    margin-bottom: 0.5rem;
}

.empty-state p {
    color: #718096;
    margin-bottom: 2rem;
    font-size: 1.1rem;
}

.empty-state .btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1rem 2rem;
    border-radius: 8px;
    text-decoration: none;
    font-weight: 600;
    transition: all 0.3s ease;
}

.table-wrapper {
    overflow-x: auto;
    border-radius: 8px;
    border: 1px solid #e2e8f0;
}

.table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    table-layout: fixed; /* Fixed layout for better column control */
}

.table th {
    background: #f8fafc;
    padding: 0.75rem;
    text-align: left;
    font-weight: 600;
    color: #2d3748;
    border-bottom: 2px solid #e2e8f0;
    white-space: nowrap; /* Prevent header text wrapping */
}

.table td {
    padding: 0.75rem;
    border-bottom: 1px solid #e2e8f0;
    vertical-align: middle;
}

/* Specific column widths */
.table th:nth-child(1), .table td:nth-child(1) { width: 6%; }  /* STT */
.table th:nth-child(2), .table td:nth-child(2) { width: 30%; } /* Ti√™u ƒë·ªÅ */
.table th:nth-child(3), .table td:nth-child(3) { width: 12%; } /* Chuy√™n m·ª•c */
.table th:nth-child(4), .table td:nth-child(4) { width: 15%; } /* Ng√†y ƒëƒÉng */
.table th:nth-child(5), .table td:nth-child(5) { width: 8%; }  /* L∆∞·ª£t xem */
.table th:nth-child(6), .table td:nth-child(6) { width: 12%; } /* Tr·∫°ng th√°i */
.table th:nth-child(7), .table td:nth-child(7) { width: 17%; } /* Thao t√°c */

.table tr:hover {
    background: #f8fafc;
}

.post-title .title-wrapper {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    flex-wrap: wrap;
}

.post-title strong {
    flex: 1;
    min-width: 0; /* Allow text to shrink */
    line-height: 1.4;
    word-break: break-word; /* Allow long words to break */
}

.badge.home {
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
    color: white;
    font-size: 0.7rem;
    padding: 0.2rem 0.5rem;
    border-radius: 10px;
    font-weight: 600;
    white-space: nowrap;
    flex-shrink: 0; /* Don't shrink */
}

.category-tag {
    background: #e2e8f0;
    color: #4a5568;
    padding: 0.25rem 0.75rem;
    border-radius: 16px;
    font-size: 0.8rem;
    font-weight: 500;
    white-space: nowrap; /* Prevent wrapping */
    display: inline-block;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
}

.view-count {
    font-weight: 600;
    color: #667eea;
    font-size: 1rem;
}

/* Date column styling */
.table td:nth-child(3) {
    font-size: 0.85rem;
    color: #4a5568;
    white-space: nowrap;
    font-family: 'Courier New', monospace; /* Monospace for better date alignment */
}

.status-badge {
    padding: 0.375rem 0.75rem;
    border-radius: 16px;
    font-size: 0.8rem;
    font-weight: 600;
    text-align: center;
    white-space: nowrap; /* Prevent wrapping */
    display: inline-block;
    min-width: 70px;
}

.status-badge.approved {
    background: linear-gradient(135deg, #d1fae5, #a7f3d0);
    color: #065f46;
}

.status-badge.pending {
    background: linear-gradient(135deg, #fef3c7, #fde68a);
    color: #92400e;
}

.action-buttons {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
}

.btn-small {
    padding: 0.5rem 0.75rem;
    font-size: 1rem;
    text-decoration: none;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 40px;
    text-align: center;
}

.btn-small.ghost {
    background: #f1f5f9;
    color: #64748b;
    border: 1px solid #e2e8f0;
}

.btn-small.ghost:hover {
    background: #e2e8f0;
    color: #475569;
}

.btn-small:not(.ghost):not(.danger) {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    color: white;
}

.btn-small:not(.ghost):not(.danger):hover {
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
    transform: translateY(-1px);
}

.btn-small.danger {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
}

.btn-small.danger:hover {
    background: linear-gradient(135deg, #dc2626, #b91c1c);
    transform: translateY(-1px);
}

/* Form button styling to match links */
.action-buttons form {
    display: inline;
    margin: 0;
}

.mobile-card-actions form {
    display: inline;
    margin: 0;
}

.btn-small[type="submit"] {
    background: none;
    border: none;
    padding: 0.5rem 0.75rem;
    font-size: 1rem;
    text-decoration: none;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.3s ease;
    min-width: 40px;
    text-align: center;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-family: inherit;
}

.btn-small[type="submit"].danger {
    background: linear-gradient(135deg, #ef4444, #dc2626);
    color: white;
}

.btn-small[type="submit"].danger:hover {
    background: linear-gradient(135deg, #dc2626, #b91c1c);
    transform: translateY(-1px);
}

.alert {
    padding: 1rem 1.5rem;
    border-radius: 8px;
    margin-bottom: 1.5rem;
    border-left: 4px solid;
}

.alert-error {
    background: #fef2f2;
    color: #dc2626;
    border-left-color: #dc2626;
}

/* Large Tablet */
@media (min-width: 769px) and (max-width: 1024px) {
    .content-container {
        padding: 0 1.5rem;
    }
    
    .stats-grid {
        grid-template-columns: repeat(3, 1fr);
    }
    
    /* Adjust column widths for tablets */
    .table th:nth-child(1), .table td:nth-child(1) { width: 30%; } /* Ti√™u ƒë·ªÅ */
    .table th:nth-child(2), .table td:nth-child(2) { width: 15%; } /* Chuy√™n m·ª•c */
    .table th:nth-child(3), .table td:nth-child(3) { width: 12%; } /* Ng√†y ƒëƒÉng */
    .table th:nth-child(4), .table td:nth-child(4) { width: 8%; }  /* L∆∞·ª£t xem */
    .table th:nth-child(5), .table td:nth-child(5) { width: 15%; } /* Tr·∫°ng th√°i */
    .table th:nth-child(6), .table td:nth-child(6) { width: 20%; } /* Thao t√°c */
}

/* Tablet */
@media (min-width: 481px) and (max-width: 768px) {
    .content-container {
        padding: 0 1rem;
    }
    
    .page-header {
        flex-direction: column;
        gap: 1.5rem;
        align-items: center;
        text-align: center;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
    }
    
    .table {
        min-width: 650px;
        font-size: 0.85rem;
    }
    
    .table th, .table td {
        padding: 0.6rem 0.4rem;
    }
}

/* Mobile */
@media (max-width: 480px) {
    .modern-main-content {
        padding: 1rem 0;
    }
    
    .content-container {
        padding: 0 0.5rem;
    }
    
    .page-header {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
        padding: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .page-title {
        font-size: 1.75rem;
        text-align: center;
    }
    
    .page-subtitle {
        text-align: center;
        font-size: 1rem;
    }
    
    .btn-primary {
        width: 100%;
        justify-content: center;
        padding: 1rem;
    }
    
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        padding: 1.5rem 1rem;
        flex-direction: column;
        text-align: center;
        gap: 1rem;
    }
    
    .dashboard-section {
        padding: 1rem;
        margin: 0 -0.5rem 1rem -0.5rem;
        border-radius: 0;
    }
    
    /* Mobile table - Card Layout */
    .table-wrapper {
        display: none; /* Hide table on mobile */
    }
    
    .mobile-cards {
        display: block;
    }
    
    .mobile-card {
        background: white;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        border-left: 4px solid #667eea;
    }
    
    .mobile-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.75rem;
    }
    
    .mobile-card-title {
        font-weight: 600;
        color: #2d3748;
        font-size: 1rem;
        line-height: 1.3;
        flex: 1;
        margin-right: 0.5rem;
    }
    
    .mobile-card-status {
        flex-shrink: 0;
    }
    
    .mobile-card-meta {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 0.75rem;
        margin-bottom: 1rem;
        font-size: 0.85rem;
    }
    
    .mobile-card-meta-item {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }
    
    .mobile-card-meta-label {
        color: #718096;
        font-size: 0.75rem;
        font-weight: 500;
    }
    
    .mobile-card-meta-value {
        color: #2d3748;
        font-weight: 500;
    }
    
    .mobile-card-actions {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
        padding-top: 0.75rem;
        border-top: 1px solid #e2e8f0;
    }
    
    .mobile-card-actions .btn-small {
        flex: 1;
        padding: 0.75rem;
        font-size: 0.85rem;
        justify-content: center;
    }
}

/* Show table on larger screens, hide mobile cards */
@media (min-width: 481px) {
    .mobile-cards {
        display: none;
    }
    
    .table-wrapper {
        display: block;
    }
}
</style>

<%@ include file="../layout/footer.jsp" %>
