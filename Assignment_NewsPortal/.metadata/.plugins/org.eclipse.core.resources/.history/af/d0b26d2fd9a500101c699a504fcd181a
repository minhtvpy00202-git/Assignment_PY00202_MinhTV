<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
  <%@ taglib prefix="c" uri="jakarta.tags.core" %>
    <%@ taglib prefix="fn" uri="jakarta.tags.functions" %>
      <c:set var="ctx" value="${pageContext.request.contextPath}" />
      <c:set var="uri" value="${pageContext.request.requestURI}" />
      <c:set var="currentPage" value="${fn:substringAfter(uri, ctx)}" />
      
      <!-- Debug info - remove after testing -->
      <!-- Current URI: ${uri} | Context: ${ctx} | Current Page: ${currentPage} -->
      <link rel="stylesheet" href="${pageContext.request.contextPath}/assets/css/admin-header.css">

      <h1 class="logo" style="text-align: center; font-size: 30px">
        <a href="${ctx}/admin/dashboard" style="text-decoration:none;color:inherit;">
          CÔNG CỤ QUẢN TRỊ TIN TỨC
        </a>
      </h1>

      <header class="admin-header">
        <div class="container">


          <nav class="nav">
            <a href="${ctx}/home" data-page="/home">
              Trang chủ
            </a>

            <a href="${ctx}/admin/news" data-page="/admin/news">
              Tin tức
            </a>

            <!-- CHỈ ADMIN -->
            <c:if test="${sessionScope.authUser != null && sessionScope.authUser.role}">
              <a href="${ctx}/admin/news-approve" data-page="/admin/news-approve">
                Duyệt bài
              </a>

              <a href="${ctx}/admin/categories" data-page="/admin/categories">
                Loại tin
              </a>

              <a href="${ctx}/admin/users" data-page="/admin/users">
                Người dùng
              </a>

              <!-- Duyệt tài khoản (pending) -->
              <a href="${ctx}/admin/users-pending" data-page="/admin/users-pending">
                Duyệt tài khoản
                <c:if test="${not empty requestScope.pendingUsers and requestScope.pendingUsers > 0}">
                  <span class="badge">${pendingUsers}</span>
                </c:if>
              </a>

              <a href="${ctx}/admin/newsletter" data-page="/admin/newsletter">
                Newsletter
              </a>
            </c:if>



            <a href="${ctx}/auth/logout" class="logout">Đăng xuất</a>
          </nav>
        </div>
      </header>

      <script>
        // Set active navigation link based on current URL
        document.addEventListener('DOMContentLoaded', function() {
          const currentPath = window.location.pathname;
          const contextPath = '${ctx}';
          const currentPage = currentPath.replace(contextPath, '');
          
          // Remove active class from all nav links
          const navLinks = document.querySelectorAll('.admin-header .nav a[data-page]');
          navLinks.forEach(link => {
            link.classList.remove('active');
            link.removeAttribute('aria-current');
          });
          
          // Add active class to matching link
          const activeLink = document.querySelector('.admin-header .nav a[data-page="' + currentPage + '"]');
          if (activeLink) {
            activeLink.classList.add('active');
            activeLink.setAttribute('aria-current', 'page');
          }
        });
      </script>