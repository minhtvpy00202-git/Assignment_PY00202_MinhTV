package com.newsportal.dao;

import com.newsportal.model.Category;
import com.newsportal.util.Jdbc;
import com.newsportal.util.RowMapper;

import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.List;

public class CategoryDAO {

    private static final RowMapper<Category> MAPPER = rs -> {
        Category c = new Category();
        c.setId(rs.getInt("Id"));
        c.setName(rs.getString("Name"));
        return c;
    };

    public List<Category> findAll() throws SQLException {
        String sql = "SELECT Id, Name FROM Categories ORDER BY Name";
        return Jdbc.query(sql, MAPPER);
    }

    public Category findById(int id) throws SQLException {
        String sql = "SELECT Id, Name FROM Categories WHERE Id = ?";
        return Jdbc.queryOne(sql, MAPPER, id);
    }

    public boolean existsName(String name) throws SQLException {
        String sql = "SELECT COUNT(*) FROM Categories WHERE Name = ?";
        Number n = Jdbc.queryForObject(sql, name);
        return n != null && n.intValue() > 0;
    }

    public int create(Category c) throws SQLException {
        String sql = "INSERT INTO Categories(Name) VALUES (?)";
        return (int) Jdbc.insertAndReturnId(sql, c.getName());
    }

    public int update(Category c) throws SQLException {
        String sql = "UPDATE Categories SET Name=? WHERE Id=?";
        return Jdbc.update(sql, c.getName(), c.getId());
    }

    public int delete(int id) throws SQLException {
        String sql = "DELETE FROM Categories WHERE Id=?";
        return Jdbc.update(sql, id);
    }

    public int count() throws SQLException {
        String sql = "SELECT COUNT(*) FROM Categories";
        Number n = Jdbc.queryForObject(sql);
        return n == null ? 0 : n.intValue();
    }
}
